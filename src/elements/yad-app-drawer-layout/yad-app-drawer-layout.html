<link rel="import" href="../yad-base-element.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../bower_components/app-layout/app-layout.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../../bower_components/app-route/app-route.html">
<link rel="import" href="../../bower_components/app-route/app-location.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/paper-item/all-imports.html">
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html">

<dom-module id="yad-app-drawer-layout">
  <template>
    <style include="iron-flex iron-flex-alignment">
      app-header {
        background-color: var(--paper-blue-900);
        color: #fff;
      }

      app-drawer-layout {
        --app-drawer-layout-content-transition: margin 0.2s;
      }

      app-drawer {
        /*
        --app-drawer-content-container: {
          background-color: #eee;
        }*/
      }

      paper-listbox {
        --paper-item-selected: {
          /*color: var(--paper-blue-900);*/
          background-color: var(--paper-blue-100);
        };
        --paper-item-focused-before: {
          background-color: transparent;
        };
      }
      paper-item:hover {
        background-color: var(--paper-indigo-200);
      }

      .drawer-content {
        margin-top: 80px;
        height: calc(100% - 80px);
        overflow: auto;
      }

      .overlay-item {
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        cursor: pointer;
      }
    </style>

    <app-location use-hash-as-path route="{{route}}"></app-location>
    <app-route route="{{route}}" pattern="/:page" data="{{pageRoute}}"></app-route>

    <app-header-layout fullbleed>

      <app-header slot="header" reveals>
        <app-toolbar>
          <paper-icon-button icon="menu" on-click="drawerClick"></paper-icon-button>
          <div main-title>My Dashboard</div>
        </app-toolbar>
      </app-header>

      <app-drawer-layout id="drawerLayout">
        <app-drawer id="drawer" slot="drawer">
          <div class="drawer-content">
            <paper-listbox id="drawerList" selected="[[pageRoute.page]]" attr-for-selected="page" on-selected-changed="drawerSelected" fallback-selection="[[computeFallback()]]">
              <template is="dom-repeat" items="[[pageNames]]">
                <paper-item page="[[item]]">
                  <div class="overlay-item">
                  </div>
                  <slot name="[[computeMenuName(item)]]">
                  </slot>

                </paper-item>
              </template>
            </paper-listbox>
          </div>
        </app-drawer>

        <iron-pages selected="[[pageRoute.page]]" attr-for-selected="page">
          <template is="dom-repeat" items="[[pageNames]]">
            <div page="[[item]]">
              <slot name="[[item]]">
              </slot>
            </div>
          </template>
        </iron-pages>

      </app-drawer-layout>
    </app-header-layout>


  </template>

  <script>
    class YadAppDrawerLayout extends YadBaseElement {
      static get is() { return 'yad-app-drawer-layout'; }
      static get properties() {
        return {
          pageNames: {
            type: Array
          }
        };
      }
      constructor() {
        super();
      }
      computeMenuName(item) {
        return item + '__menu';
      }
      computeFallback() {
        return this.pageNames[0];
      }
      drawerClick(e) {
        var drawerLayout = this.$.drawerLayout;
        if(drawerLayout.forceNarrow || !drawerLayout.narrow) {
          drawerLayout.forceNarrow = !drawerLayout.forceNarrow;
        } else {
          drawerLayout.drawer.toggle();
        }
      }
      drawerSelected(e) {
        var drawerLayout = this.$.drawerLayout;
        location.hash = '#/' + this.$.drawerList.selected;
        if(!(drawerLayout.forceNarrow || !drawerLayout.narrow)) {
          drawerLayout.drawer.close();
        }
      }
      nodeRedMsg(msg) {
      }
    }
    window.customElements.define(YadAppDrawerLayout.is, YadAppDrawerLayout);
  </script>
</dom-module>

<!-- <> -->
